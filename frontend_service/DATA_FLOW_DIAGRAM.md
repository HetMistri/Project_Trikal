# Frontend to Backend Data Flow - Visual Guide

## ğŸ”„ Complete Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERACTION                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ User clicks map
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       REACT FRONTEND (Port 5173)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  MapSelector.jsx                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. User clicks map at coordinates (lat, lng)                   â”‚   â”‚
â”‚  â”‚ 2. LocationMarker component captures click event               â”‚   â”‚
â”‚  â”‚ 3. setPosition({ lat: X, lng: Y })                            â”‚   â”‚
â”‚  â”‚ 4. Marker appears on map                                       â”‚   â”‚
â”‚  â”‚ 5. Coordinate panel shows: Lat: X, Lng: Y                     â”‚   â”‚
â”‚  â”‚ 6. Buttons appear: [âœ“ Send to Backend] [âœ• Clear]              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                     â”‚
â”‚                                  â”‚ User clicks "Send to Backend"       â”‚
â”‚                                  â†“                                     â”‚
â”‚  handleConfirm() function                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ const payload = {                                              â”‚   â”‚
â”‚  â”‚   latitude: position.lat,    // e.g., 40.7128                â”‚   â”‚
â”‚  â”‚   longitude: position.lng    // e.g., -74.0060               â”‚   â”‚
â”‚  â”‚ }                                                              â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚ axios.post(                                                    â”‚   â”‚
â”‚  â”‚   'http://localhost:8000/api/aoi-format/',                   â”‚   â”‚
â”‚  â”‚   payload                                                      â”‚   â”‚
â”‚  â”‚ )                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ HTTP POST Request
                                  â”‚ Content-Type: application/json
                                  â”‚ Body: { latitude: 40.7128, longitude: -74.0060 }
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DJANGO BACKEND (Port 8000)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  urls.py                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Route: /api/aoi-format/                                        â”‚   â”‚
â”‚  â”‚ View:  AOIFormatView                                           â”‚   â”‚
â”‚  â”‚ Method: POST                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                     â”‚
â”‚                                  â†“                                     â”‚
â”‚  views.py - AOIFormatView                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ def post(self, request):                                       â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚   # 1. Extract coordinates from request                       â”‚   â”‚
â”‚  â”‚   lat = request.data.get("latitude")    # 40.7128            â”‚   â”‚
â”‚  â”‚   lon = request.data.get("longitude")   # -74.0060           â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚   # 2. Validate coordinates                                    â”‚   â”‚
â”‚  â”‚   if lat is None or lon is None:                              â”‚   â”‚
â”‚  â”‚     return Response(error, status=400)                        â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚   # 3. Create bounding box polygon                            â”‚   â”‚
â”‚  â”‚   offset = 0.01                                               â”‚   â”‚
â”‚  â”‚   coords = [                                                  â”‚   â”‚
â”‚  â”‚     (lon - offset, lat - offset),  # Bottom-left             â”‚   â”‚
â”‚  â”‚     (lon + offset, lat - offset),  # Bottom-right            â”‚   â”‚
â”‚  â”‚     (lon + offset, lat + offset),  # Top-right               â”‚   â”‚
â”‚  â”‚     (lon - offset, lat + offset),  # Top-left                â”‚   â”‚
â”‚  â”‚     (lon - offset, lat - offset)   # Close polygon           â”‚   â”‚
â”‚  â”‚   ]                                                            â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚   # 4. Convert to WKT (Well-Known Text) format                â”‚   â”‚
â”‚  â”‚   polygon = Polygon(coords)                                    â”‚   â”‚
â”‚  â”‚   wkt_format = polygon.wkt                                     â”‚   â”‚
â”‚  â”‚   # "POLYGON((-74.016 40.7028, ...))"                         â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚   # 5. Calculate date range (30 days)                         â”‚   â”‚
â”‚  â”‚   end_date = datetime.now(pytz.UTC)                           â”‚   â”‚
â”‚  â”‚   start_date = end_date - timedelta(days=30)                  â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚   # 6. Prepare response                                        â”‚   â”‚
â”‚  â”‚   response_data = {                                            â”‚   â”‚
â”‚  â”‚     "aoi": wkt_format,                                         â”‚   â”‚
â”‚  â”‚     "input_date": {                                            â”‚   â”‚
â”‚  â”‚       "start": "2025-09-04T12:00:00Z",                        â”‚   â”‚
â”‚  â”‚       "end": "2025-10-04T12:00:00Z"                           â”‚   â”‚
â”‚  â”‚     }                                                           â”‚   â”‚
â”‚  â”‚   }                                                            â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚   return Response(response_data, status=200)                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ HTTP Response (JSON)
                                  â”‚ Status: 200 OK
                                  â”‚ {
                                  â”‚   "aoi": "POLYGON((-74.016 40.7028, ...))",
                                  â”‚   "input_date": {
                                  â”‚     "start": "2025-09-04T12:00:00Z",
                                  â”‚     "end": "2025-10-04T12:00:00Z"
                                  â”‚   }
                                  â”‚ }
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       REACT FRONTEND (Port 5173)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  MapSelector.jsx - handleConfirm() catch block                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ const response = await axios.post(...)                         â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚ // Success! We got response                                    â”‚   â”‚
â”‚  â”‚ console.log('âœ… Backend Response:', response.data)             â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚ // Extract data from response                                  â”‚   â”‚
â”‚  â”‚ const aoi = response.data.aoi                                  â”‚   â”‚
â”‚  â”‚ const startDate = response.data.input_date.start              â”‚   â”‚
â”‚  â”‚ const endDate = response.data.input_date.end                  â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚ // Show success message to user                                â”‚   â”‚
â”‚  â”‚ setMessage(                                                    â”‚   â”‚
â”‚  â”‚   `âœ… Success! Data sent to backend.\n` +                      â”‚   â”‚
â”‚  â”‚   `AOI: POLYGON(...)\n` +                                      â”‚   â”‚
â”‚  â”‚   `Date Range: 2025-09-04 to 2025-10-04`                      â”‚   â”‚
â”‚  â”‚ )                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           USER SEES RESULT                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  âœ… Success! Data sent to backend.                                    â”‚
â”‚  AOI: POLYGON((-74.016 40.7028, ...))                                 â”‚
â”‚  Date Range: 2025-09-04 to 2025-10-04                                â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ Request/Response Examples

### Request (Frontend â†’ Backend)
```http
POST /api/aoi-format/ HTTP/1.1
Host: localhost:8000
Content-Type: application/json

{
  "latitude": 40.7128,
  "longitude": -74.0060
}
```

### Response (Backend â†’ Frontend)
```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "aoi": "POLYGON((-74.016 40.7028, -74.004 40.7028, -74.004 40.7228, -74.016 40.7228, -74.016 40.7028))",
  "input_date": {
    "start": "2025-09-04T12:34:56Z",
    "end": "2025-10-04T12:34:56Z"
  }
}
```

## ğŸ” Error Handling Flow

### Scenario 1: Backend Not Running
```
Frontend â†’ axios.post() â†’ ECONNREFUSED
                         â†“
                   error.request exists
                         â†“
                   Show message:
                   "No response from server.
                    Is Django running?"
```

### Scenario 2: Invalid Data (400 Bad Request)
```
Frontend â†’ axios.post() â†’ 400 Bad Request
                         â†“
                   error.response exists
                         â†“
                   Show message:
                   "Status: 400
                    Message: Missing latitude"
```

### Scenario 3: CORS Error
```
Frontend â†’ axios.post() â†’ CORS policy blocked
                         â†“
                   Browser blocks request
                         â†“
                   Console shows:
                   "Access to fetch has been blocked"
                         â†“
                   Fix: Add CORS headers in Django
```

## ğŸ¯ Key Files

| File | Purpose |
|------|---------|
| `frontend_service/src/components/MapSelector.jsx` | Main React component |
| `backend_service/himaliyan_sentinel/mlapi/views.py` | Django view handling requests |
| `backend_service/himaliyan_sentinel/mlapi/urls.py` | URL routing |
| `backend_service/himaliyan_sentinel/himaliyan_sentinel/settings.py` | CORS configuration |

## ğŸ“Š Data Transformation

```
User Click               Frontend Capture         Backend Processing
  (Map)                    (JavaScript)              (Python)
    â”‚                           â”‚                         â”‚
    â”‚  Lat: 40.7128            â”‚                         â”‚
    â”‚  Lng: -74.0060           â”‚                         â”‚
    â”‚                           â”‚                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                         â”‚
                                â”‚                         â”‚
                      { latitude: 40.7128,                â”‚
                        longitude: -74.0060 }             â”‚
                                â”‚                         â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
                                                          â”‚
                                                 Create bounding box:
                                                 [(-74.016, 40.7028),
                                                  (-74.004, 40.7028),
                                                  (-74.004, 40.7228),
                                                  (-74.016, 40.7228)]
                                                          â”‚
                                                 Convert to WKT:
                                                 "POLYGON(...)"
                                                          â”‚
                                                 Add date range:
                                                 30 days back
                                                          â”‚
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                      { aoi: "POLYGON(...)",
                        input_date: { ... } }
                                â”‚
                   Display to user
```

---

**Summary**: Frontend captures lat/lng from map clicks, sends to Django backend via axios POST, backend creates polygon and date range, returns data, frontend displays success message.
